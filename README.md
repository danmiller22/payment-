# Telegram Payment Bot (Deno Deploy + GitHub Actions)

Бот для Telegram, который публикует 4 раза в день пост в заданную группу с текстом об оплате и кнопками:

- «Получить номера сейчас» — ведёт на ссылку оплаты
- «Связаться с техподдержкой» — ведёт в чат техподдержки

Код написан для деплоя на **Deno Deploy** и планировщика через **GitHub Actions**.

## 1. Подготовка Telegram-бота

У тебя уже есть:

- Токен бота: `8326572992:...`
- ID группы: `-1003402110749`
- Ссылка оплаты (кнопка + QR):  
  `https://qr.finik.kg/c1b526b5-040b-4eca-9017-6df94e6f8d71?type=t`

Обязательно **не коммить токен** в репозиторий. Все секреты кладём в переменные окружения.

## 2. Деплой на Deno Deploy

1. Создай новый проект на https://dash.deno.com
2. Подключи этот репозиторий GitHub к Deno Deploy.
3. В настройках проекта задай переменные окружения:

   - `BOT_TOKEN` — токен бота
   - `CHAT_ID` — `-1003402110749`
   - `PAYMENT_URL` — ссылка оплаты (из QR)
   - `SUPPORT_USERNAME` — ник техподдержки без `@`, например `kghome_support`
   - `CRON_SECRET` — любой длинный секрет, например сгенерированный UUID

4. После деплоя у проекта будет URL, например  
   `https://kghome-bot.deno.dev`

5. В Telegram установи вебхук (один раз):

   Отправь запрос (можно через браузер, curl или Postman):

   ```text
   https://api.telegram.org/bot<BOT_TOKEN>/setWebhook?url=https://kghome-bot.deno.dev/
   ```

   Подставь свой `BOT_TOKEN` и реальный URL проекта.

## 3. Автопостинг 4 раза в день

Автопостинг реализуется так:

- В Deno Deploy есть эндпоинт `/cron?secret=...`, который шлёт пост в группу.
- GitHub Actions 4 раза в день делает GET-запрос на этот эндпоинт.

### GitHub Actions

В репозитории есть файл `.github/workflows/scheduler.yml`.

Перед коммитом замени плейсхолдеры:

- `YOUR_DENO_APP_URL` → реальный URL проекта Deno Deploy
- В настройках репозитория GitHub добавь секрет:
  - `CRON_SECRET` — тот же, что и на Deno Deploy

## 4. Поведение бота

- 4 раза в день GitHub Actions дёргает `/cron?secret=...` → бот отправляет в группу пост с текстом и кнопками.
- При `/start` или `/help` в личке бот отвечает короткой справкой, но основная работа идёт через автопосты в группу.

## 5. Безопасность

- Никогда не клади `BOT_TOKEN` в код / репозиторий.
- Всегда используй переменные окружения и секреты GitHub / Deno Deploy.
- `CRON_SECRET` должен совпадать между GitHub и Deno Deploy, чтобы никто посторонний не мог спамить постами через /cron.
